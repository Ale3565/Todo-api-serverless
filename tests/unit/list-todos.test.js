"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Set up environment first
process.env.NODE_ENV = 'test';
process.env.TABLE_NAME = 'TestTodos';
// Mock the DynamoDB and CloudWatch utilities
jest.mock('../../src/lambda/utils/dynamodb');
jest.mock('../../src/lambda/utils/cloudwatch');
const list_todos_1 = require("../../src/lambda/handlers/list-todos");
const dynamodb_1 = require("../../src/lambda/utils/dynamodb");
const cloudwatch_1 = require("../../src/lambda/utils/cloudwatch");
// Get mocked instances
const mockDynamoDb = dynamodb_1.dynamoDb;
const mockPublishMetric = cloudwatch_1.publishMetric;
describe('list-todos handler', () => {
    beforeEach(() => {
        // Reset all mocks
        jest.clearAllMocks();
        // Set up default mock behaviors
        mockPublishMetric.mockResolvedValue(undefined);
    });
    it('should list todos successfully', async () => {
        const mockTodos = [
            { todoId: '1', title: 'Todo 1', completed: false, createdAt: '2023-01-01T00:00:00.000Z' },
            { todoId: '2', title: 'Todo 2', completed: true, createdAt: '2023-01-02T00:00:00.000Z' }
        ];
        mockDynamoDb.send.mockResolvedValueOnce({ Items: mockTodos });
        const event = {
            httpMethod: 'GET',
            path: '/todos'
        };
        const result = await (0, list_todos_1.handler)(event);
        expect(result.statusCode).toBe(200);
        expect(JSON.parse(result.body).success).toBe(true);
        expect(JSON.parse(result.body).data.todos).toHaveLength(2);
        expect(JSON.parse(result.body).data.count).toBe(2);
        expect(mockDynamoDb.send).toHaveBeenCalledTimes(1);
        expect(mockPublishMetric).toHaveBeenCalledWith('TodosListedCount', 1);
    });
    it('should return empty array when no todos exist', async () => {
        mockDynamoDb.send.mockResolvedValueOnce({ Items: [] });
        const event = {
            httpMethod: 'GET',
            path: '/todos'
        };
        const result = await (0, list_todos_1.handler)(event);
        expect(result.statusCode).toBe(200);
        expect(JSON.parse(result.body).success).toBe(true);
        expect(JSON.parse(result.body).data.todos).toHaveLength(0);
        expect(JSON.parse(result.body).data.count).toBe(0);
        expect(mockDynamoDb.send).toHaveBeenCalledTimes(1);
    });
    it('should handle DynamoDB errors', async () => {
        mockDynamoDb.send.mockRejectedValueOnce(new Error('DynamoDB Error'));
        const event = {
            httpMethod: 'GET',
            path: '/todos'
        };
        const result = await (0, list_todos_1.handler)(event);
        expect(result.statusCode).toBe(500);
        expect(JSON.parse(result.body).error).toBe('DB_ERROR');
        expect(mockDynamoDb.send).toHaveBeenCalledTimes(1);
    });
    it('should sort todos by creation date (newest first)', async () => {
        const mockTodos = [
            { todoId: '1', title: 'Old Todo', completed: false, createdAt: '2023-01-01T00:00:00.000Z' },
            { todoId: '2', title: 'New Todo', completed: true, createdAt: '2023-01-03T00:00:00.000Z' },
            { todoId: '3', title: 'Middle Todo', completed: false, createdAt: '2023-01-02T00:00:00.000Z' }
        ];
        mockDynamoDb.send.mockResolvedValueOnce({ Items: mockTodos });
        const event = {
            httpMethod: 'GET',
            path: '/todos'
        };
        const result = await (0, list_todos_1.handler)(event);
        const responseData = JSON.parse(result.body).data;
        expect(result.statusCode).toBe(200);
        expect(responseData.todos[0].title).toBe('New Todo');
        expect(responseData.todos[1].title).toBe('Middle Todo');
        expect(responseData.todos[2].title).toBe('Old Todo');
        expect(mockDynamoDb.send).toHaveBeenCalledTimes(1);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC10b2Rvcy50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibGlzdC10b2Rvcy50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsMkJBQTJCO0FBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQztBQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBRyxXQUFXLENBQUM7QUFFckMsNkNBQTZDO0FBQzdDLElBQUksQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQUM3QyxJQUFJLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7QUFHL0MscUVBQStEO0FBQy9ELDhEQUEyRDtBQUMzRCxrRUFBa0U7QUFFbEUsdUJBQXVCO0FBQ3ZCLE1BQU0sWUFBWSxHQUFHLG1CQUF3QyxDQUFDO0FBQzlELE1BQU0saUJBQWlCLEdBQUcsMEJBQTBELENBQUM7QUFFckYsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2Qsa0JBQWtCO1FBQ2xCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVyQixnQ0FBZ0M7UUFDaEMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDakQsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDOUMsTUFBTSxTQUFTLEdBQUc7WUFDaEIsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsMEJBQTBCLEVBQUU7WUFDekYsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsMEJBQTBCLEVBQUU7U0FDekYsQ0FBQztRQUVGLFlBQVksQ0FBQyxJ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QUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDckQsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3hELE1BQU0sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNyRCxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTZXQgdXAgZW52aXJvbm1lbnQgZmlyc3RcclxucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XHJcbnByb2Nlc3MuZW52LlRBQkxFX05BTUUgPSAnVGVzdFRvZG9zJztcclxuXHJcbi8vIE1vY2sgdGhlIER5bmFtb0RCIGFuZCBDbG91ZFdhdGNoIHV0aWxpdGllc1xyXG5qZXN0Lm1vY2soJy4uLy4uL3NyYy9sYW1iZGEvdXRpbHMvZHluYW1vZGInKTtcclxuamVzdC5tb2NrKCcuLi8uLi9zcmMvbGFtYmRhL3V0aWxzL2Nsb3Vkd2F0Y2gnKTtcclxuXHJcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IGhhbmRsZXIgfSBmcm9tICcuLi8uLi9zcmMvbGFtYmRhL2hhbmRsZXJzL2xpc3QtdG9kb3MnO1xyXG5pbXBvcnQgeyBkeW5hbW9EYiB9IGZyb20gJy4uLy4uL3NyYy9sYW1iZGEvdXRpbHMvZHluYW1vZGInO1xyXG5pbXBvcnQgeyBwdWJsaXNoTWV0cmljIH0gZnJvbSAnLi4vLi4vc3JjL2xhbWJkYS91dGlscy9jbG91ZHdhdGNoJztcclxuXHJcbi8vIEdldCBtb2NrZWQgaW5zdGFuY2VzXHJcbmNvbnN0IG1vY2tEeW5hbW9EYiA9IGR5bmFtb0RiIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBkeW5hbW9EYj47XHJcbmNvbnN0IG1vY2tQdWJsaXNoTWV0cmljID0gcHVibGlzaE1ldHJpYyBhcyBqZXN0Lk1vY2tlZEZ1bmN0aW9uPHR5cGVvZiBwdWJsaXNoTWV0cmljPjtcclxuXHJcbmRlc2NyaWJlKCdsaXN0LXRvZG9zIGhhbmRsZXInLCAoKSA9PiB7XHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAvLyBSZXNldCBhbGwgbW9ja3NcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgXHJcbiAgICAvLyBTZXQgdXAgZGVmYXVsdCBtb2NrIGJlaGF2aW9yc1xyXG4gICAgbW9ja1B1Ymxpc2hNZXRyaWMubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBsaXN0IHRvZG9zIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG1vY2tUb2RvcyA9IFtcclxuICAgICAgeyB0b2RvSWQ6ICcxJywgdGl0bGU6ICdUb2RvIDEnLCBjb21wbGV0ZWQ6IGZhbHNlLCBjcmVhdGVkQXQ6ICcyMDIzLTAxLTAxVDAwOjAwOjAwLjAwMFonIH0sXHJcbiAgICAgIHsgdG9kb0lkOiAnMicsIHRpdGxlOiAnVG9kbyAyJywgY29tcGxldGVkOiB0cnVlLCBjcmVhdGVkQXQ6ICcyMDIzLTAxLTAyVDAwOjAwOjAwLjAwMFonIH1cclxuICAgIF07XHJcblxyXG4gICAgbW9ja0R5bmFtb0RiLnNlbmQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgSXRlbXM6IG1vY2tUb2RvcyB9KTtcclxuXHJcbiAgICBjb25zdCBldmVudDogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudD4gPSB7XHJcbiAgICAgIGh0dHBNZXRob2Q6ICdHRVQnLFxyXG4gICAgICBwYXRoOiAnL3RvZG9zJ1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50IGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50KTtcclxuXHJcbiAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcclxuICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc3VsdC5ib2R5KS5zdWNjZXNzKS50b0JlKHRydWUpO1xyXG4gICAgZXhwZWN0KEpTT04ucGFyc2UocmVzdWx0LmJvZHkpLmRhdGEudG9kb3MpLnRvSGF2ZUxlbmd0aCgyKTtcclxuICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc3VsdC5ib2R5KS5kYXRhLmNvdW50KS50b0JlKDIpO1xyXG4gICAgZXhwZWN0KG1vY2tEeW5hbW9EYi5zZW5kKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XHJcbiAgICBleHBlY3QobW9ja1B1Ymxpc2hNZXRyaWMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdUb2Rvc0xpc3RlZENvdW50JywgMSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IHdoZW4gbm8gdG9kb3MgZXhpc3QnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBtb2NrRHluYW1vRGIuc2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBJdGVtczogW10gfSk7XHJcblxyXG4gICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xyXG4gICAgICBodHRwTWV0aG9kOiAnR0VUJyxcclxuICAgICAgcGF0aDogJy90b2RvcydcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XHJcblxyXG4gICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XHJcbiAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkuc3VjY2VzcykudG9CZSh0cnVlKTtcclxuICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc3VsdC5ib2R5KS5kYXRhLnRvZG9zKS50b0hhdmVMZW5ndGgoMCk7XHJcbiAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkuZGF0YS5jb3VudCkudG9CZSgwKTtcclxuICAgIGV4cGVjdChtb2NrRHluYW1vRGIuc2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGhhbmRsZSBEeW5hbW9EQiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBtb2NrRHluYW1vRGIuc2VuZC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdEeW5hbW9EQiBFcnJvcicpKTtcclxuXHJcbiAgICBjb25zdCBldmVudDogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudD4gPSB7XHJcbiAgICAgIGh0dHBNZXRob2Q6ICdHRVQnLFxyXG4gICAgICBwYXRoOiAnL3RvZG9zJ1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50IGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50KTtcclxuXHJcbiAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNTAwKTtcclxuICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc3VsdC5ib2R5KS5lcnJvcikudG9CZSgnREJfRVJST1InKTtcclxuICAgIGV4cGVjdChtb2NrRHluYW1vRGIuc2VuZCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIHNvcnQgdG9kb3MgYnkgY3JlYXRpb24gZGF0ZSAobmV3ZXN0IGZpcnN0KScsIGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG1vY2tUb2RvcyA9IFtcclxuICAgICAgeyB0b2RvSWQ6ICcxJywgdGl0bGU6ICdPbGQgVG9kbycsIGNvbXBsZXRlZDogZmFsc2UsIGNyZWF0ZWRBdDogJzIwMjMtMDEtMDFUMDA6MDA6MDAuMDAwWicgfSxcclxuICAgICAgeyB0b2RvSWQ6ICcyJywgdGl0bGU6ICdOZXcgVG9kbycsIGNvbXBsZXRlZDogdHJ1ZSwgY3JlYXRlZEF0OiAnMjAyMy0wMS0wM1QwMDowMDowMC4wMDBaJyB9LFxyXG4gICAgICB7IHRvZG9JZDogJzMnLCB0aXRsZTogJ01pZGRsZSBUb2RvJywgY29tcGxldGVkOiBmYWxzZSwgY3JlYXRlZEF0OiAnMjAyMy0wMS0wMlQwMDowMDowMC4wMDBaJyB9XHJcbiAgICBdO1xyXG5cclxuICAgIG1vY2tEeW5hbW9EYi5zZW5kLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IEl0ZW1zOiBtb2NrVG9kb3MgfSk7XHJcblxyXG4gICAgY29uc3QgZXZlbnQ6IFBhcnRpYWw8QVBJR2F0ZXdheVByb3h5RXZlbnQ+ID0ge1xyXG4gICAgICBodHRwTWV0aG9kOiAnR0VUJyxcclxuICAgICAgcGF0aDogJy90b2RvcydcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCBhcyBBUElHYXRld2F5UHJveHlFdmVudCk7XHJcbiAgICBjb25zdCByZXNwb25zZURhdGEgPSBKU09OLnBhcnNlKHJlc3VsdC5ib2R5KS5kYXRhO1xyXG5cclxuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlRGF0YS50b2Rvc1swXS50aXRsZSkudG9CZSgnTmV3IFRvZG8nKTsgXHJcbiAgICBleHBlY3QocmVzcG9uc2VEYXRhLnRvZG9zWzFdLnRpdGxlKS50b0JlKCdNaWRkbGUgVG9kbycpO1xyXG4gICAgZXhwZWN0KHJlc3BvbnNlRGF0YS50b2Rvc1syXS50aXRsZSkudG9CZSgnT2xkIFRvZG8nKTsgXHJcbiAgICBleHBlY3QobW9ja0R5bmFtb0RiLnNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcclxuICB9KTtcclxufSk7Il19